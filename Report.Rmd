---
title: "Predicting Newborn Weight"
author: Liam Coleman-Aulenbach, Venessa Keung, Lucy Wang
output: pdf_document
documentclass: article
---

```{r setup, include=FALSE}
# Knitr Configuration
knitr::opts_chunk$set(include=FALSE, results="hide")
```

```{r import}
# Import
births <- read.csv("chds_births.csv")
```

# Summary

# Model Selection

## Data Diagnostic

### Data Exploration

### Outliers

### Missing Data

## Data Preprocessing

### Filling Missing Values

```{r mice}
library(mice)
m <- 5

multiplyImputedBirths <- mice(births, m = m, method = "pmm", seed = 500, printFlag = FALSE)

imputedBirths <- lapply(1:m, function(i) complete(multiplyImputedBirths, i))
```


### Decoding

```{r preprocessData}
# Re-encoding and labelling variates
decodeBirthVariates <- function (birthsDataset) {
  ethLabels <- c(
    "Caucasian",
    "Mexican",
    "African-American",
    "Asian",
    "Mixed",
    "Other"
  )
  edLabels <- c(
    "elementary school",
    "middle school",
    "high school",
    "high school + trade school",
    "high school + some college",
    "college graduate",
    "trade school",
    "high school unclear"
  )

  birthsDataset$meth <- cut(
    birthsDataset$meth,
    breaks = c(0, 5:10), 
    labels = ethLabels,
    right = TRUE,
    include.lowest= TRUE
  )
  
  birthsDataset$med <- cut(
    birthsDataset$med,
    breaks = 0:8, 
    labels = edLabels,
    right = FALSE
  )
  
  birthsDataset$feth <- cut(
    birthsDataset$feth,
    breaks = c(0, 5:10), 
    labels = ethLabels,
    right = TRUE,
    include.lowest= TRUE
  )
  
  birthsDataset$fed <- cut(
    birthsDataset$fed,
    breaks = 0:8, 
    labels = edLabels,
    right = FALSE
  )
  
  birthsDataset$smoke <- cut(
    birthsDataset$smoke,
    breaks = 0:4, 
    labels = c(
      "never",
      "smoke now",
      "until pregnancy",
      "not anymore"
    ),
    right = FALSE
  )
  
  birthsDataset$marital <- cut(
    birthsDataset$marital,
    breaks = 0:5, 
    labels = c(
      "married",
      "legally separated",
      "divorced",
      "widowed",
      "never married"
    )
  )
  
  birthsDataset$number <- cut(
    birthsDataset$number,
    breaks = 0:10,
    labels = c(
      "never smoked",
      "1-4",
      "5-9",
      "10-14",
      "15-19",
      "20-29",
      "30-39",
      "40-60",
      "more than 60",
      "smoked but don't know how much"
    ),
    right = FALSE
  )

  birthsDataset$time <- cut(
    birthsDataset$time,
    breaks = 0:10,
    labels = c(
      "never smoked",
      "still smokes",
      "during pregnancy",
      "less than a year",
      "1-2 years",
      "2-3 years",
      "3-4 years",
      "5-9 years",
      "more than 10 years",
      "quit but don't know when"
    ),
    right = FALSE
  )

  birthsDataset$income <- cut(
    birthsDataset$income,
    breaks = c(0, 1, 2, 10),
    labels = c(
      "under 2500",
      "2500-4999",
      "5000-over 25000"
    ),
    right = FALSE
  )
  
  birthsDataset
}

decodedImputedBirths <- lapply(imputedBirths, decodeBirthVariates)
```

## Candidate Model 1

### Automated Model Selection

```{r model1}
birthModelAIC <- 10000000
finalAutomatedBirthModel <- lm(wt ~ 1, data = birth)

for(birthModel in decodedImputedBirths) {
  adjustedBirthModel <- birthModel
  adjustedBirthModel$smoke <- NULL
  adjustedBirthModel$number <- NULL
  M0 <- lm(wt ~ 1, data = birthModel)
  Mmax <- lm(wt ~ (.- marital - time - meth - feth - med - fed)^2 + marital + time + meth + feth + med + fed, data = adjustedBirthModel)
    
  #checking if there are betas that are NA
  beta.max <- coef(Mmax)
  names(beta.max)[is.na(beta.max)]
  anyNA(coef(Mmax))

  buildModel <- function(adjustedBirthModel, predictVar, direction="both", excludeVars=c(), MAX_ITERS=1000) {
    data = na.omit(adjustedBirthModel[, !colnames(adjustedBirthModel) %in% excludeVars])
    step(
      lm(
        as.formula(paste(predictVar, "~", ".")),
        data=data
      ),
      scope = list(lower = M0, upper = Mmax),
      direction=direction,
      steps=MAX_ITERS
    )
  }
  model <- buildModel(adjustedBirthModel, "wt", excludeVars=c())
  modelAIC <- AIC(model)
  if (modelAIC < birthModelAIC) {
    print("=========================================")
    finalAutomatedBirthModel <- model
    birthModelAIC <- modelAIC
  }
}

print(birthModelAIC)
print(summary(finalAutomatedBirthModel))

```


## Candidate Model 2

### Hand-crafted Features

### Automated Model Selection



# Model Diagnostics

## Significance


## AIC


## Cross-Validation


# Discussion



# Appendix
```{r, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE, include=TRUE}
```
